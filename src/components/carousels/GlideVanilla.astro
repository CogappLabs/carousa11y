---
import { slides } from '../../data/slides'
import Slide from '../Slide.astro'
import '@glidejs/glide/dist/css/glide.core.min.css'
import '@glidejs/glide/dist/css/glide.theme.min.css'
---

<div class="glide carousel-loading" aria-label="Featured content carousel" role="region">
  <div class="glide__track" data-glide-el="track">
    <ul class="glide__slides">
      {slides.map((s) => (
        <li class="glide__slide">
          <Slide {...s} />
        </li>
      ))}
    </ul>
  </div>
  <div class="glide__arrows" data-glide-el="controls">
    <button type="button" class="glide__arrow glide__arrow--left" data-glide-dir="<">Previous</button>
    <button type="button" class="glide__arrow glide__arrow--right" data-glide-dir=">">Next</button>
  </div>
  <div class="glide__bullets" data-glide-el="controls[nav]">
    {slides.map((_, i) => (
      <button
        class="glide__bullet"
        data-glide-dir={`=${i}`}
        aria-label={`Go to slide ${i + 1}`}
        aria-current={i === 0 ? 'true' : undefined}
      ></button>
    ))}
  </div>
</div>

<script>
  import { setCarouselReady } from '../../utils/carousel'

  async function initGlide() {
    const Glide = (await import('@glidejs/glide')).default
    const bullets = document.querySelectorAll('.glide__bullet')

    const glide = new Glide('.glide', { type: 'carousel', perView: 1 }) as any

    glide.on('run', () => {
      // Only update aria-current (Glide handles its own active class via CSS)
      bullets.forEach((bullet, i) => {
        if (i === glide.index) {
          bullet.setAttribute('aria-current', 'true')
        } else {
          bullet.removeAttribute('aria-current')
        }
      })
    })

    glide.mount()
    setCarouselReady(document.querySelector('.glide'))
  }

  initGlide()
</script>
