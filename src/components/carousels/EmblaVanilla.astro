---
import { slides } from '../../data/slides'
import Slide from '../Slide.astro'
---

<div class="overflow-hidden carousel-loading" id="embla-container" role="region" aria-label="Featured content carousel">
  <div id="embla-viewport" class="overflow-hidden">
    <div class="flex">
      {slides.map((s) => (
        <Slide {...s} class="flex-[0_0_100%] min-w-0 px-4" />
      ))}
    </div>
  </div>
  <div class="flex justify-center gap-4 mt-4">
    <button id="embla-prev" type="button" class="carousel-btn">Previous</button>
    <button id="embla-next" type="button" class="carousel-btn">Next</button>
  </div>
  <div id="embla-dots" class="flex justify-center gap-2 mt-4"></div>
</div>

<script>
  import { createDots, updateDots, setCarouselReady } from '../../utils/carousel'

  async function initEmbla() {
    const EmblaCarousel = (await import('embla-carousel')).default
    const Accessibility = (await import('embla-carousel-accessibility')).default

    const emblaNode = document.getElementById('embla-viewport')
    const dotsContainer = document.getElementById('embla-dots')
    if (!emblaNode || !dotsContainer) return

    const embla = EmblaCarousel(emblaNode, { loop: true }, [Accessibility()])

    document.getElementById('embla-prev')?.addEventListener('click', () => embla.goToPrev())
    document.getElementById('embla-next')?.addEventListener('click', () => embla.goToNext())

    const dots = createDots(dotsContainer, embla.slideNodes().length, (i) => embla.goTo(i))

    embla.on('select', () => updateDots(dots, embla.selectedSnap()))
    updateDots(dots, embla.selectedSnap())

    setCarouselReady(document.getElementById('embla-container'))
  }

  initEmbla()
</script>
